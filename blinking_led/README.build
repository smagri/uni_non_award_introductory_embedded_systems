sudo apt update
sudo apt install gcc-avr avr-libc binutils-avr avrdude

avr-gcc -mmcu=atmega328p -Os -o main.elf main.c
OR Example for Arduino Uno (ATmega328P):
avr-gcc -mmcu=atmega328p -DF_CPU=16000000UL -Os main.c -o main.elf
OR to catch potential issues:
avr-gcc -mmcu=atmega328p -Os -Wall -Wextra -o main.elf main.c


# Convert the elf file created by previous command to a .hex file
# which the arduino needs to run your program.
avr-objcopy -O ihex main.elf main.hex

# Flash the .hex file to ATmega328p, for eg arduino UNO as ISP:
avrdude -c arduino -p m328p -P /dev/ttyACM0 -b 115200 -U flash:w:main.hex:i




Here is chatGPT explination of these commands:
---------------------------------------------
Your command:
avr-gcc -mmcu=atmega328p -Os -o main.elf main.c

Breakdown:

avr-gcc – The AVR cross-compiler for C code targeting AVR microcontrollers.

-mmcu=atmega328p

– Tells the compiler which MCU you are targeting. This affects things
  like available registers, memory layout, and startup files.

-Os

– Optimizes the compiled code for size (smaller binary, less flash
  used). Alternative: -O2 (speed), -O0 (no optimization, easier
  debugging).

-o main.elf

– Sets the output file to main.elf. The .elf format is an executable
  and linkable format containing debug info.

main.c – Your source file.

Next Steps After Compilation

Check compilation result
If no errors, main.elf will be generated.

Convert to HEX for flashing
Microcontrollers usually require a HEX file:

avr-objcopy -O ihex -R .eeprom main.elf main.hex


Flash to ATmega328P
Using avrdude and, for example, an Arduino UNO as ISP:

avrdude -c arduino -p m328p -P /dev/ttyACM0 -b 115200 -U flash:w:main.hex:i


Adjust -P /dev/ttyACM0 to your device port.

Replace -c arduino with your programmer type if different.

Optional: Enable Warnings

To catch potential issues:

avr-gcc -mmcu=atmega328p -Os -Wall -Wextra -o main.elf main.c


If you want, I can give you a ready-to-use one-liner that compiles,
converts to HEX, and flashes the ATmega328P in one go.

